{% extends "base.html" %}

{% block title %}Estadísticas - FocusFit{% endblock %}

{% block extra_head %}
<style>
  .card {
    transition: transform 0.2s ease;
  }
  .card:hover {
    transform: translateY(-2px);
  }
</style>
{% endblock %}

{% block content %}
  <!-- Header moderno -->
  <div class="text-center mb-5">
    <h2 class="text-primary fs-3 fw-bold mb-2">Estadísticas</h2>
    <p class="text-muted fs-6">Analiza tu rendimiento y progreso</p>
  </div>

  <!-- Estadísticas Principales -->
  <div class="row g-4 mb-5">
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm h-100 text-center" style="transition: transform 0.3s ease, box-shadow 0.3s ease;">
        <div class="card-body p-4" style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-radius: 0.5rem;">
          <div class="mb-3">
            <i class="fas fa-fire text-primary" style="font-size: 2rem;"></i>
          </div>
          <div class="display-4 text-primary fw-bold mb-2">{{ estadisticas.rachas or 0 }}</div>
          <h6 class="fw-semibold text-dark mb-2">Racha Actual</h6>
          <small class="text-muted fw-medium">
            <i class="fas fa-calendar-check me-1"></i>Días consecutivos
          </small>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm h-100 text-center" style="transition: transform 0.3s ease, box-shadow 0.3s ease;">
        <div class="card-body p-4" style="background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border-radius: 0.5rem;">
          <div class="mb-3">
            <i class="fas fa-trophy text-success" style="font-size: 2rem;"></i>
          </div>
          <div class="display-4 text-success fw-bold mb-2">{{ estadisticas.racha_maxima or 0 }}</div>
          <h6 class="fw-semibold text-dark mb-2">Mejor Racha</h6>
          <small class="text-muted fw-medium">
            <i class="fas fa-crown me-1"></i>Récord personal
          </small>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm h-100 text-center" style="transition: transform 0.3s ease, box-shadow 0.3s ease;">
        <div class="card-body p-4" style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); border-radius: 0.5rem;">
          <div class="mb-3">
            <i class="fas fa-chart-line text-warning" style="font-size: 2rem;"></i>
          </div>
          <div class="display-4 text-warning fw-bold mb-2">{{ estadisticas.cumplimiento_porcentaje or 0 }}<span class="fs-5">%</span></div>
          <h6 class="fw-semibold text-dark mb-2">Cumplimiento</h6>
          <small class="text-muted fw-medium">
            <i class="fas fa-clock me-1"></i>Últimos 30 días
          </small>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm h-100 text-center" style="transition: transform 0.3s ease, box-shadow 0.3s ease;">
        <div class="card-body p-4" style="background: linear-gradient(135deg, #e1f5fe, #b3e5fc); border-radius: 0.5rem;">
          <div class="mb-3">
            <i class="fas fa-stopwatch text-info" style="font-size: 2rem;"></i>
          </div>
          <div class="display-4 text-info fw-bold mb-2">{{ estadisticas.tiempo_total or 0 }}<span class="fs-5">h</span></div>
          <h6 class="fw-semibold text-dark mb-2">Tiempo Total</h6>
          <small class="text-muted fw-medium">
            <i class="fas fa-hourglass-half me-1"></i>Horas invertidas
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Estadísticas Detalladas -->
  <div class="row g-4 mb-5">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm">
        <div class="card-header text-center text-white border-0 bg-primary" style="padding: 1.25rem;">
          <h5 class="mb-1 fw-semibold">Progreso de Constancia</h5>
          <small class="opacity-75">Seguimiento de tu rendimiento</small>
        </div>
        <div class="card-body p-4">
          <div class="row g-4 mb-4">
            <div class="col-md-6">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <span class="fw-medium text-dark">Días Completados</span>
                <div class="text-end">
                  <div class="fw-bold text-success fs-5">{{ estadisticas.dias_completados or 0 }}</div>
                  <small class="text-muted">de {{ estadisticas.dias_programados or 0 }}</small>
                </div>
              </div>
              <div class="progress" style="height: 12px; border-radius: 6px;">
                <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" 
                     style="width: {{ (estadisticas.dias_completados / estadisticas.dias_programados * 100) if estadisticas.dias_programados > 0 else 0 }}%"></div>
              </div>
              <small class="text-muted mt-1 d-block">
                {{ ((estadisticas.dias_completados / estadisticas.dias_programados * 100) if estadisticas.dias_programados > 0 else 0)|round(1) }}% completado
              </small>
            </div>
            <div class="col-md-6">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <span class="fw-medium text-dark">Días Programados</span>
                <div class="text-end">
                  <div class="fw-bold text-primary fs-5">{{ estadisticas.dias_programados or 0 }}</div>
                  <small class="text-muted">total</small>
                </div>
              </div>
              <div class="progress" style="height: 12px; border-radius: 6px;">
                <div class="progress-bar bg-primary progress-bar-striped" style="width: 100%"></div>
              </div>
              <small class="text-muted mt-1 d-block">Base de referencia</small>
            </div>
          </div>
          
          <div class="row g-3">
            <div class="col-md-4">
              <div class="card border-0 text-center" style="background: linear-gradient(135deg, #e1f5fe, #b3e5fc);">
                <div class="card-body p-3">
                  <div class="mb-2">
                    <i class="fas fa-calendar-day text-info" style="font-size: 1.5rem;"></i>
                  </div>
                  <div class="h4 text-info mb-1 fw-bold">{{ estadisticas.dias_activos or 0 }}</div>
                  <small class="text-muted fw-medium">Días Activos</small>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card border-0 text-center" style="background: linear-gradient(135deg, #e3f2fd, #bbdefb);">
                <div class="card-body p-3">
                  <div class="mb-2">
                    <i class="fas fa-list text-primary" style="font-size: 1.5rem;"></i>
                  </div>
                  <div class="h4 text-primary mb-1 fw-bold">{{ estadisticas.total_rutinas or 0 }}</div>
                  <small class="text-muted fw-medium">Rutinas Creadas</small>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card border-0 text-center" style="background: linear-gradient(135deg, #e8f5e8, #c8e6c9);">
                <div class="card-body p-3">
                  <div class="mb-2">
                    <i class="fas fa-check-circle text-success" style="font-size: 1.5rem;"></i>
                  </div>
                  <div class="h4 text-success mb-1 fw-bold">{{ estadisticas.tareas_completadas_total or 0 }}</div>
                  <small class="text-muted fw-medium">Tareas Completadas</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header text-center text-white border-0 bg-success" style="padding: 1.25rem;">
          <h5 class="mb-1 fw-semibold">Análisis de Constancia</h5>
          <small class="opacity-75">Tu nivel actual</small>
        </div>
        <div class="card-body p-4">
          {% set constancia_nivel = 'Principiante' %}
          {% set constancia_color = 'secondary' %}
          {% set constancia_icono = 'seedling' %}
          
          {% if estadisticas.cumplimiento_porcentaje >= 80 %}
            {% set constancia_nivel = 'Excepcional' %}
            {% set constancia_color = 'success' %}
            {% set constancia_icono = 'trophy' %}
          {% elif estadisticas.cumplimiento_porcentaje >= 60 %}
            {% set constancia_nivel = 'Muy Bueno' %}
            {% set constancia_color = 'primary' %}
            {% set constancia_icono = 'star' %}
          {% elif estadisticas.cumplimiento_porcentaje >= 40 %}
            {% set constancia_nivel = 'Bueno' %}
            {% set constancia_color = 'info' %}
            {% set constancia_icono = 'dumbbell' %}
          {% elif estadisticas.cumplimiento_porcentaje >= 20 %}
            {% set constancia_nivel = 'En Progreso' %}
            {% set constancia_color = 'warning' %}
            {% set constancia_icono = 'chart-line' %}
          {% endif %}
          
          <div class="text-center">
            <div class="mb-3">
              <i class="fas fa-{{ constancia_icono }} text-{{ constancia_color }}" style="font-size: 3rem;"></i>
            </div>
            <h4 class="text-{{ constancia_color }} fw-bold mb-2">{{ constancia_nivel }}</h4>
            <p class="text-muted fw-medium mb-4">Nivel de Constancia</p>
            
            <div class="p-3 rounded" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
              <small class="text-muted">
                {% if estadisticas.racha_maxima > 0 %}
                  Tu mejor racha ha sido de <strong class="text-{{ constancia_color }}">{{ estadisticas.racha_maxima }} días</strong>. 
                {% endif %}
                
                {% if estadisticas.rachas > 0 %}
                  Actualmente llevas <strong class="text-{{ constancia_color }}">{{ estadisticas.rachas }} días</strong> consecutivos.
                {% else %}
                  ¡Empieza tu racha completando las tareas de hoy!
                {% endif %}
              </small>
            </div>
            
            <!-- Medidor de progreso circular visual -->
            <div class="mt-4">
              <div class="progress mx-auto" style="height: 8px; width: 80%; border-radius: 4px;">
                <div class="progress-bar bg-{{ constancia_color }}" 
                     style="width: {{ estadisticas.cumplimiento_porcentaje or 0 }}%">
                </div>
              </div>
              <small class="text-muted mt-2 d-block">{{ estadisticas.cumplimiento_porcentaje or 0 }}% de constancia</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% if not estadisticas or (estadisticas.total_rutinas == 0) %}
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card border-0 shadow-sm text-center">
        <div class="card-body p-5">
          <div class="mb-4">
            <i class="fas fa-chart-pie text-muted" style="font-size: 4rem;"></i>
          </div>
          <h5 class="text-muted mb-3">¡Empieza tu journey!</h5>
          <p class="text-muted mb-4">
            Aún no tienes rutinas creadas. Las estadísticas aparecerán cuando empieces a usar la app y completes tus primeras tareas.
          </p>
          <div class="d-flex justify-content-center gap-3 flex-wrap">
            <a href="/crear_rutina" class="btn btn-primary btn-lg">
              <i class="fas fa-plus me-2"></i>Crear Primera Rutina
            </a>
            <a href="/lista_diaria" class="btn btn-outline-primary btn-lg">
              <i class="fas fa-tasks me-2"></i>Ver Tareas
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

{% endblock %}

{% block extra_js %}
<script>
// Animaciones suaves para las cards
document.addEventListener('DOMContentLoaded', function() {
  const cards = document.querySelectorAll('.card');
  cards.forEach((card, index) => {
    card.style.animationDelay = `${index * 0.1}s`;
    card.classList.add('fade-in');
  });
});
</script>
{% endblock %}
