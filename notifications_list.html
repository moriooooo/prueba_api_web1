{% extends 'base.html' %}

{% block title %}Notificaciones{% endblock %}

{% block content %}
<h2>Notificaciones</h2>
<div class="list-group">
  {% for n in notifications %}
    <div class="list-group-item d-flex justify-content-between align-items-start">
      <div>
        <h5>{{ n.title }}</h5>
        <p class="mb-0">{{ n.message }}</p>
        <small class="text-muted">Programada: {{ n.fecha_programada }}</small>
      </div>
      <div>
        {% if not n.is_read %}
          <button class="btn btn-sm btn-primary mark-read" data-id="{{ n.id }}">Marcar leída</button>
        {% else %}
          <span class="badge bg-secondary">Leída</span>
        {% endif %}
      </div>
    </div>
  {% else %}
    <div class="alert alert-info">No hay notificaciones</div>
  {% endfor %}
</div>

<script>
document.addEventListener('click', function(e){
  if(e.target && e.target.classList.contains('mark-read')){
    const id = e.target.getAttribute('data-id');
    fetch('/api/notifications/mark_delivered', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({id: parseInt(id)})}).then(()=>{ location.reload(); }).catch(()=>{});
  }
});
</script>

{% endblock %}
